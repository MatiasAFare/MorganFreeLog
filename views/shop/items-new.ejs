<!DOCTYPE html>
<html>
  <head>
    <title>Nuevo Producto</title>
    <link rel="stylesheet" href="/css/style.css" />
  </head>

  <body>
    <div class="container">
      <h1>Nuevo Producto</h1>

      <% if (error) { %>
      <div class="alert alert-danger"><%= error %></div>
      <% } %>

      <form action="/shop" method="POST">
        <div class="form-group">
          <label for="name">Nombre:</label>
          <input type="text" id="name" name="name" required />
        </div>

        <div class="form-group">
          <label for="price">Precio:</label>
          <input type="number" id="price" name="price" step="0.01" min="0" required />
        </div>

        <div class="form-group">
          <label for="stock">Stock:</label>
          <input type="number" id="stock" name="stock" min="0" required />
        </div>

        <div class="form-group">
          <label for="category">Categor√≠a:</label>
          <select id="category-select">
            <option value="">Seleccione una categor√≠a existente</option>
            <% categories.forEach(cat => { %>
            <option value="<%= cat %>"><%= cat %></option>
            <% }); %>
          </select>
          
          <div style="margin: 10px 0; text-align: center; color: #6c757d; font-weight: 500;">
            ‚Äî O ‚Äî
          </div>
          
          <label for="new-category-input">Nueva categor√≠a:</label>
          <input type="text" id="new-category-input" placeholder="Escriba una nueva categor√≠a..." 
                 style="padding: 8px; border: 1px solid #ced4da; border-radius: 4px; width: 100%;" />
          
          <!-- Campo hidden que se enviar√° al backend -->
          <input type="hidden" id="category" name="category" value="" />
          
          <small style="color: #6c757d; font-size: 12px; display: block; margin-top: 5px;">
            üí° Seleccione una categor√≠a existente O escriba una nueva (no ambas)
          </small>
        </div>

        <div class="form-group">
          <button type="submit" class="btn btn-primary">Crear Producto</button>
          <a href="/shop" class="btn btn-secondary">Cancelar</a>
        </div>
      </form>
    </div>
    
    <script>
      // Manejo de categor√≠a mutuamente excluyente
      const categorySelect = document.getElementById('category-select');
      const newCategoryInput = document.getElementById('new-category-input');
      const hiddenCategoryField = document.getElementById('category');
      
      // Cuando se selecciona una categor√≠a existente
      categorySelect.addEventListener('change', function() {
        if (this.value) {
          newCategoryInput.value = '';
          newCategoryInput.style.opacity = '0.5';
          newCategoryInput.disabled = true;
          hiddenCategoryField.value = this.value;
        } else {
          newCategoryInput.style.opacity = '1';
          newCategoryInput.disabled = false;
          hiddenCategoryField.value = '';
        }
      });
      
      // Cuando se escribe una nueva categor√≠a
      newCategoryInput.addEventListener('input', function() {
        const newValue = this.value.trim();
        if (newValue) {
          categorySelect.value = '';
          categorySelect.style.opacity = '0.5';
          categorySelect.disabled = true;
          hiddenCategoryField.value = newValue;
        } else {
          categorySelect.style.opacity = '1';
          categorySelect.disabled = false;
          hiddenCategoryField.value = '';
        }
      });
      
      // Validaci√≥n antes del submit
      document.querySelector('form').addEventListener('submit', function(e) {
        const finalCategory = hiddenCategoryField.value;
        
        if (!finalCategory) {
          e.preventDefault();
          alert('Por favor seleccione una categor√≠a existente o escriba una nueva.');
          return false;
        }
        
        console.log('Enviando categor√≠a:', finalCategory); // Para debug
      });
    </script>
  </body>
</html>